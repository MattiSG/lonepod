<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Jukebox</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzicato/0.6.1/Pizzicato.min.js"></script>
    <script>
    /***** Play Sound *****/
    var playsound = function (filename) {
      var sound = new Pizzicato.Sound(filename, function() {
        // Sound loaded!
        sound.play();
      });
    };
    $(document).ready(function () {
      $("#button-kick").click(function () {
        playsound('sounds/kick.wav');
      });
      $("#button-cough").click(function () {
        playsound('sounds/cough.wav');
      });
      $("#button-hush").click(function () {
        playsound('sounds/hush.wav');
      });
      $("#button-oh").click(function () {
        playsound('sounds/oh.wav');
      });
      $("#button-snort").click( function () {
        playsound('sounds/snort.wav');
      });
      $("#button-hum").click( function () {
        playsound('sounds/hum.wav');
      });
    });
    /***** Record Sound *****/
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    if (navigator.getUserMedia) {
      navigator.getUserMedia({ audio: true }, function (stream) {
          audioContext = new AudioContext();
          analyser = audioContext.createAnalyser();
          microphone = audioContext.createMediaStreamSource(stream);
          javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

          analyser.smoothingTimeConstant = 0.8;
          analyser.fftSize = 1024;

          microphone.connect(analyser);
          analyser.connect(javascriptNode);
          javascriptNode.connect(audioContext.destination);

          javascriptNode.onaudioprocess = function() {
            var array = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(array);
            var values = 0;

            var length = array.length;
            for (var i = 0; i < length; i++) {
              values += array[i];
            }

            var average = values / length;

            /***** TEST *****/
            console.log(average);
            if (average > 50) {
              playsound('sounds/hush.wav');
            }
            /****************/
          };
        },
        function(err) {
          console.log("The following error occured: " + err.name);
        }
      );
    } else {
      console.log("getUserMedia not supported");
    }
    </script>
    <style>
      button {
        border: none;
        color: white;
        height: 100px;
        width: 100px;
        margin: 2px;
      }
      .red {
        background-color: #e51400;
      }
      .green {
        background-color: #60a917;
      }
      .blue {
        background-color: #1ba1e2;
      }
      .yellow {
        background-color: #e3c800;
      }
      .purple {
        background-color: #aa00ff;
      }
      .orange {
        background-color: #fa6800;
      }
    </style>
  </head>
  <body>
    <button id="button-kick" class="red">Kick</button>
    <button id="button-cough" class="green">Cough</button>
    <button id="button-hush" class="blue">Hush</button>
    <button id="button-oh" class="yellow">Oh</button>
    <button id="button-snort" class="purple">Snort</button>
    <button id="button-hum" class="orange">Hum</button>
  </body>
</html>
